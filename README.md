# What is this?

This is a TLS server using a vendored fork of the Go TLS stack that has renegotation indication extension forcibly disabled, which will trigger CVE-2009-3555 mitigations in OpenSSL 3.0+. Note that it isn't truly vulnerable to CVE-2009-3555 because the Go TLS stack doesn't allow renegotiations at all.

The function of this program is to act as a test server for TLS clients that refuse to connect to servers with insecure client renegotiation configurations, like OpenSSL 3.0+ without the SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION option.



# Bring your own CA

See https://arminreiter.com/2022/01/create-your-own-certificate-authority-ca-using-openssl/

```
openssl genrsa -out my-ca-key.pem 4096

openssl req -x509 -new -nodes -key my-ca-key.pem \
  -sha256 -days 1826 -out my-ca.crt \
  -subj '/CN=My Root CA/C=AT/ST=Vienna/L=Vienna/OU=MyOrganisation/O=MyOrganisation'

```

copy to `/usr/local/share/ca-certificate/`

run `update-ca-certificates`

for Fedora 38:
```
sudo trust anchor --store ./my-ca.crt 
sudo update-ca-trust
```

then

```
cat > localhost.v3.ext << EOF
authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names

[alt_names]
DNS.1 = localhost4.localdomain4
DNS.2 = myserver1.local
IP.1 = 127.0.0.1
IP.2 = 192.168.2.1
EOF

openssl req -new -nodes -out localhost.csr -newkey rsa:4096 \
  -keyout go-key.pem -subj '/CN=My Firewall/C=AT/ST=Vienna/L=Vienna/OU=MyOrganisation/O=MyOrganisation'

openssl x509 -req -in localhost.csr -CA my-ca.crt \
  -CAkey my-ca-key.pem -CAcreateserial -out golang-tls.pem \
  -days 730 -sha256 -extfile localhost.v3.ext

```

# Usage

```
go build
./tls-test &
```

see how to configure openssl  https://github.com/npm/cli/issues/6070#issuecomment-1643427867

and test it with

```
export OPENSSL_CONF=`pwd`/node-openssl/openssl-node.cnf
curl https://localhost4.localdomain4:3333
```

and with [node test](./node-openssl/test.sh)

# Related links

https://live.paloaltonetworks.com/t5/general-topics/ssl-routines-unsafe-legacy-renegotiation-disabled/td-p/520652

https://knowledgebase.paloaltonetworks.com/KCSArticleDetail?id=kA10g000000POJ0CAO&lang=en_US%E2%80%A9

# Video presentation

https://youtu.be/d6hhazj1nsc

[![youtube presentation](https://img.youtube.com/vi/d6hhazj1nsc/0.jpg)](https://www.youtube.com/watch?v=d6hhazj1nsc)

and watch the demo


https://github.com/giuliohome/cve-2009-3555-test-server/assets/3272563/86a7bf62-56f2-4d03-ac4b-e0cbd2d99d72


